<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="Operational report / Strategy Offsite Q4 2025"/>
<title>Operational report / Strategy Offsite Q4 2025</title>

<!-- Chart.js + DataLabels -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0" defer></script>

<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
  background-color: #f9fafb;
  color: #374151;
  line-height: 1.6;
}

.container { padding: 2rem; max-width: 1200px; margin: 0 auto; }
.space-y-8 > * + * { margin-top: 2rem; }

.card {
  background: #fff;
  border-radius: 0.8rem;
  padding: 1.5rem;
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.card h2 {
  font-size: 1.35rem;
  font-weight: 800;
  margin-bottom: 1rem;
  color: #78350f;
}

.cover-slide {
  text-align: center;
  padding: 2.5rem;
  background-color: #fffbeb;
  border-radius: 1rem;
  border: 1px solid #fde68a;
}

.cover-slide h1 {
  font-size: 2rem;
  font-weight: 900;
  color: #b45309;
}

.cover-slide .meta {
  margin-top: 0.5rem;
  font-size: 0.9rem;
  color: #6b7280;
}

.text-sm { font-size: 0.92rem; }
.text-gray-700 { color: #374151; }
.text-center { text-align: center; }
.mt-4 { margin-top: 1rem; }

.chart-container {
  position: relative;
  height: 340px;
  margin-top: 1rem;
}

.btn {
  padding: 0.6rem 0.9rem;
  border: 1px solid #f59e0b;
  border-radius: 0.6rem;
  background: #fff7ed;
  cursor: pointer;
}

.btn:hover { background: #ffedd5; }

@media print {
  .no-print { display: none !important; }
  body { background: #fff; }
  .card { box-shadow: none; border: 1px solid #fcd34d; }
}

/* ===== Card 9 Table â€“ visual fix only ===== */
.card table {
  width: 100%;
  border-collapse: collapse;
  table-layout: fixed;
  margin-top: 1rem;
}

.card table thead th {
  background-color: #fef3c7;
  color: #78350f;
  font-weight: 800;
  font-size: 0.9rem;
  padding: 0.75rem;
  border: 1px solid #fcd34d;
  text-align: left;
}

.card table tbody td {
  font-size: 0.88rem;
  padding: 0.75rem;
  border: 1px solid #fde68a;
  vertical-align: top;
  line-height: 1.45;
}

.card table tbody tr:nth-child(even) {
  background-color: #fffbeb;
}


</style>
</head>

<body>

<script>
  if (localStorage.getItem('auth') !== 'true') {
    window.location.href = 'login.html';
  }
</script>

  
<!-- Logo -->
<div style="display:flex; justify-content:center; margin:2rem 0;">
  <img src="logo.png" alt="robot.com logo" style="height:56px;">
</div>

<div class="container space-y-8">

  <!-- Cover -->
  <div class="cover-slide">
    <h1>Operational Report / Strategy Offsite Q4 2025</h1>
    <p class="meta">Prepared by: Sergio PachÃ³n Â· Andres Severino Â· Carlos Camelo</p>
  </div>

  <!-- Context -->
  <section class="card text-center" id="context">
    <h2>Report Context: On-Time Orders, NPS, and Growth Constraints</h2>
    <p class="text-sm text-gray-700">
      This report uses <strong>On-Time Orders % (0â€“40 minute SLA)</strong> as the primary performance metric.
      Performance is analyzed through dual-axis comparisons against operational drivers,
      complemented by NPS feedback and growth constraints identified by Sodexo.
    </p>
  </section>

<!-- Card 1 -->
<div class="card" id="card-1">
  <h2>1. On-Time % Orders vs Headcount Field OPS</h2>

  <div class="chart-container">
    <canvas id="onTimeVsOpsChart"></canvas>
  </div>

  <p class="text-sm text-gray-700 mt-4">
    This chart compares On-Time Orders % (0â€“40m SLA) against Field Ops headcount over time.
    It helps assess whether service reliability is moving consistently with staffing capacity
    and highlights periods where SLA volatility may require operational adjustments beyond staffing.
  </p>
</div>

  <!-- Card 2 -->
  <div class="card" id="card-2">
    <h2>2. On-Time % Orders vs Volume Orders</h2>

    <div class="chart-container">
      <canvas id="onTimeVsOrdersChart"></canvas>
    </div>

    <p class="text-sm text-gray-700 mt-4">
      Relationship between service reliability (On-Time SLA 0â€“40m) and total order volume over time.
    </p>
  </div>

<!-- Card 3 -->
<div class="card" id="card-3">
  <h2>3. On-Time % Orders vs Fleet Availability</h2>

  <div class="chart-container">
    <canvas id="onTimeVsFleetChart"></canvas>
  </div>

  <p class="text-sm text-gray-700 mt-4">
    This chart compares On-Time Orders % (0â€“40m SLA) against fleet availability.
    It helps identify whether SLA changes align with availability constraints or if
    performance shifts are driven by other operational factors.
  </p>
</div>

  <!-- Card 4 -->
  <div class="card" id="card-4">
    <h2>4. On-Time % Orders vs Total Miles</h2>

    <div class="chart-container">
      <canvas id="onTimeVsMilesChart"></canvas>
    </div>

    <p class="text-sm text-gray-700 mt-4">
      Comparison between <strong>On-Time Orders %</strong> and <strong>Total Miles</strong>,
      highlighting the impact of delivery distance on SLA performance.
    </p>
  </div>

 <!-- Card 5 -->
<div class="card" id="card-5">
  <h2>5. On-Time % Orders (excluding kitchen / loading time)</h2>

  <div class="chart-container">
    <canvas id="onTimeExcludingKitchenChart"></canvas>
  </div>

  <p class="text-sm text-gray-700 mt-4">
    This comparison isolates the impact of kitchen and loading time on SLA performance.
    The consistently higher on-time rate when excluding kitchen/loading time indicates
    that a significant portion of SLA degradation occurs before dispatch rather than
    during in-transit execution, positioning kitchen efficiency as a primary lever for
    SLA improvement.
  </p>
</div>

<!-- Card 6 -->
<div class="card" id="card-6">
  <h2>6. AVG Transit Times (Pickup â†’ Customer)</h2>

  <div class="chart-container">
    <canvas id="avgTransitTimesChart"></canvas>
    
  </div>

  <p class="text-sm text-gray-700 mt-4">
    This view compares average in-transit time against average end-to-end delivery time.
    When both move together, SLA pressure is driven by movement and routing; when delivery time
    increases disproportionately, the gap indicates pre-dispatch constraints (pickup readiness / loading).
  </p>
</div>

<!-- Card 7 -->
<div class="card" id="card-7">
  <h2>7. Responsibility Split vs Avg Delivery Time</h2>

  <!-- Chart 7A: Avg Transit vs Avg Delivery Time -->
  <div class="chart-container">
    <canvas id="responsibilityStackedChart"></canvas>
  </div>


  <p class="text-sm text-gray-700 mt-4">
    This breakdown shows proportional responsibility by month relative to average delivery time.
    While we continue optimizing internal processes, robot speed is not a scalable lever.
    A material share of delivery-time variability is driven by kitchen/loading execution
    and customer readiness, where Sodexo and campus-side operations play a direct role.
  </p>
</div>

  <!-- Card 8 -->
  <div class="card" id="card-8">
    <h2>8. On-Time % Orders vs # Campus Operative</h2>

    <div class="chart-container">
      <canvas id="onTimeVsCampusOpsChart"></canvas>
    </div>

    <p class="text-sm text-gray-700 mt-4">
      This chart compares <strong>On-Time Orders % (0â€“40m SLA)</strong> against the
      <strong>number of operative campuses</strong>, showing how operational scale
      impacts service reliability.
    </p>
  </div>

<!-- Card 9 -->
<div class="card" id="card-9">
  <h2>9. NPS Customer Campus</h2>

  <div class="chart-container">
    <canvas id="npsCampusChart"></canvas>
  </div>

  <p class="text-sm text-gray-700 mt-4">
    NPS (Net Promoter Score) is based on a 0â€“10 recommendation question and is computed as
    <strong>% Promoters (9â€“10) âˆ’ % Detractors (0â€“6)</strong>. Respondents scoring
    <strong>7â€“8</strong> are <strong>Passives</strong> (neutral) and do not directly increase the score.
    A score <strong>&gt; 0</strong> means promoters outweigh detractors, while
    <strong>&lt; 0</strong> means detractors dominate. We show <strong># Responses</strong> alongside
    NPS to indicate how stable each semesterâ€™s result is.
    <br><br>
    The dashed baseline at <strong>NPS = 0</strong> highlights the shift from negative to positive
    campus sentiment since <strong>2024 Fall</strong>.
  </p>
</div>

  <!-- Card 10 -->
  <div class="card">
    <h2>10. Pains Sodexo and Plan</h2>
    <table style="width:100%; table-layout: fixed;">
  <colgroup>
    <col style="width:14%">
    <col style="width:26%">
    <col style="width:22%">
    <col style="width:20%">
    <col style="width:18%">
  </colgroup>

  <thead>
    <tr>
      <th>Pain (Sodexo)</th>
      <th>Description</th>
      <th>Next Steps</th>
      <th>Success Metrics</th>
      <th>Help Tech</th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td><strong>Indirect operational load on Sodexo staff</strong></td>
      <td>
        Because some operational activities take place inside Sodexo offices,
        tasks such as maintenance and support functions have indirectly involved
        Sodexo personnel.
        <br><br>
        In <strong>Jacksonville</strong>, this created the perception that Sodexo staff
        were partially responsible for managing order volume, an issue that became
        more evident during Robertaâ€™s campus visit.
      </td>
      <td>
        <strong>1.</strong> Evaluate relocating maintenance activities outside Sodexo offices.
        <br><br>
        <strong>2.</strong> Increase field team capacity by <strong>+1</strong> and deploy additional robots in Jacksonville.
        <br><br>
        <strong>3.</strong> Assign a single owner for order dispatching to reduce operational noise.
      </td>
      <td>
        <strong>1.</strong> Reduction of Crystal workload for Sodexo staff.
        <br><br>
        <strong>2.</strong> â‰¥ 80% SLA compliance for 0â€“40 minute deliveries.
        <br><br>
        <strong>3.</strong> Reduced dispatch time for fully charged bots.
        <br><br>
        <strong>4.</strong> Increased bot availability at deployment time.
      </td>
      <td>
        <strong>1.</strong> Ability to measure when the bot is loaded and time to movement â†’ <strong>IT</strong>.
        <br><br>
        <strong>2.</strong> NFC implementation to measure successful load percentage â†’ <strong>IT</strong>.
      </td>
    </tr>

    <tr>
      <td><strong>On-Time Orders Performance</strong></td>
      <td>
        Increase the percentage of on-time orders while reducing workload on kitchen staff.
        <br><br>
        In some campuses, kitchens prepare orders but cannot find available bots,
        generating double work.
        <br><br>
        In other cases, once loaded, staff perceive delays before the bot starts moving.
      </td>
      <td>
        <strong>1.</strong> Rebalance robot fleet per campus to meet demand and ensure consistent availability.
        <br><br>
        <strong>2.</strong> Adjust operational KPI for <strong>At Pick / Assignment</strong> to â‰¤ 2 minutes.
        <br><br>
        <strong>3.</strong> Evaluate bot return behavior after completing deliveries.
        <br><br>
        <strong>4.</strong> Clearly define acceptable in-transit performance vs. issue indicators.
      </td>
      <td>
        <strong>1.</strong> Increase SLA (0â€“40 min) to <strong>90%</strong>.
        <br><br>
        <strong>2.</strong> Achieve â‰¤ 2 minutes at Pick/Assignment.
        <br><br>
        <strong>3.</strong> Track in-transit time, ticket volume, and categories.
        <br><br>
        <strong>4.</strong> Monitor autonomy interventions per meter/second in transit.
      </td>
      <td>
        <strong>1.</strong> Measure load time and time to movement â†’ <strong>IT</strong>.
        <br><br>
        <strong>2.</strong> In-transit time analysis by ticket category â†’ <strong>SD / Data</strong>.
        <br><br>
        <strong>3.</strong> Autonomy interventions per meter/second â†’ <strong>Autonomy / Data</strong>.
      </td>
    </tr>

    <tr>
      <td><strong>Defect Rate Perception</strong></td>
      <td>
        From a student experience perspective, improve defect rate measurement
        and reduce it from the current <strong>3%</strong>.
        <br><br>
        Excluding incomplete orders, the defect rate is below 1%.
        However, incomplete orders are returned to the restaurant,
        increasing kitchen workload and perceived issues.
      </td>
      <td>
        <strong>1.</strong> Clearly define and separate reasons for
        <strong>canceled</strong> vs. <strong>incomplete</strong> orders â†’ OPS â†’ IT.
      </td>
      <td>
        <strong>1.</strong> Defect Rate.
        <br><br>
        <strong>2.</strong> Success Rate.
        <br><br>
        <strong>3.</strong> Root-cause percentage breakdown.
      </td>
      <td>
        <strong>1.</strong> Standardized taxonomy for canceled vs. incomplete orders â†’ <strong>OPS / IT</strong>.
      </td>
    </tr>
  </tbody>
</table>
  </div>

  <!-- Actions -->
  <div class="no-print" style="display:flex; justify-content:flex-end;">
    <button class="btn" onclick="window.print()">Print / Save as PDF</button>
  </div>

</div>

<!-- Charts JS -->
<script>
window.addEventListener('DOMContentLoaded', () => {
  if (!window.Chart) return;
  if (window.ChartDataLabels) Chart.register(ChartDataLabels);

  // Visual standard (as agreed)
  const GRAY_LINE = '#6B7280';     // On-Time line + legend + % labels
  const AMBER_LABEL = '#92400e';   // Bar labels

  // Data (2024 + 2025) â€” keep exactly as provided previously
  const LABELS = [
    "Jan-2024","Feb-2024","Mar-2024","Apr-2024","May-2024",
    "Aug-2024","Sep-2024","Oct-2024","Nov-2024","Dec-2024",
    "Jan-2025","Feb-2025","Mar-2025","Apr-2025","May-2025",
    "Aug-2025","Sep-2025","Oct-2025","Nov-2025","Dec-2025"
  ];

  const ON_TIME = [
    73.51,81.77,83.85,82.63,83.77,
    62.75,60.33,62.28,65.01,64.83,
    37.56,43.3,60.73,74.62,74.65,
    59.29,67.16,77.7,81.4,78.11
  ];

  const TOTAL_ORDERS = [
    8365,12769,8807,10493,1489,
    2389,11604,12477,10070,6160,
    10108,15542,11810,13362,3267,
    3028,14376,14824,11789,5422
  ];

  const TOTAL_MILES = [
    0,0,0,0,23,
    53,516,3861,7140,3100,
    11127,18719,17290,20241,8647,
    7035,22371,30755,23876,12612
  ];

  const CAMPUS_OPERATIVE = [
   29, 29, 29, 29, 20,
  20, 20, 20, 20, 20,
  20, 20, 20, 20, 20,
  18, 18, 18, 18, 18
  ];

  // Shared options builder
  function buildDualAxisOptions(rightLabel, liftLegend=false) {
    return {
      maintainAspectRatio: false,
      interaction: { mode: 'index', intersect: false },

      // Only lift legend in Card 2 to prevent overlap with % labels
      layout: liftLegend ? { padding: { top: 24 } } : {},

      plugins: {
        legend: {
          position: 'top',
          labels: {
            color: GRAY_LINE,
            padding: liftLegend ? 22 : 12
          }
        },
        tooltip: {
          callbacks: {
            label: function(context) {
              if (context.dataset.yAxisID === 'y') {
                return ` ${context.dataset.label}: ${context.parsed.y}%`;
              }
              return ` ${context.dataset.label}: ${context.parsed.y.toLocaleString()}`;
            }
          }
        }
      },

      scales: {
        y: {
          position: 'left',
          min: 0,
          max: 100,
          ticks: { callback: v => v + '%' },
          title: { display: true, text: 'On-Time Orders % (0â€“40m SLA)' }
        },
        y1: {
          position: 'right',
          grid: { drawOnChartArea: false },
          title: { display: true, text: rightLabel }
        }
      }
    };
  }

  // Dataset builders
  function onTimeDataset() {
    return {
      type: 'line',
      label: 'On-Time Orders %',
      data: ON_TIME,
      yAxisID: 'y',
      borderColor: GRAY_LINE,
      backgroundColor: GRAY_LINE,
      tension: 0.3,
      pointRadius: 4,
      pointHoverRadius: 5,
      datalabels: {
        formatter: v => v + '%',
        color: GRAY_LINE,
        font: { size: 12, weight: 'bold' },
        align: 'top',
        anchor: 'end'
      }
    };
  }

  // Bars: default center labels; optional "special-case" for Feb-2025 in Card 2
  function barDataset(label, data, formatter, specialCaseFeb2025=false) {
    return {
      type: 'bar',
      label,
      data,
      yAxisID: 'y1',
      backgroundColor: '#fde047',
      borderColor: '#facc15',
      borderWidth: 1,
      datalabels: {
        formatter,
        color: AMBER_LABEL,
        font: { size: 10, weight: 'normal' },
        anchor: 'center',
        align: (ctx) => {
          if (specialCaseFeb2025 && LABELS[ctx.dataIndex] === 'Feb-2025') {
            return 'bottom'; // move down ONLY for Card 2 / Feb-2025
          }
          return 'center';
        }
      }
    };
  }

  // ---------- Card 2 ----------
  const ordersCtx = document.getElementById('onTimeVsOrdersChart');
  if (ordersCtx) {
    new Chart(ordersCtx, {
      data: {
        labels: LABELS,
        datasets: [
          onTimeDataset(),
          barDataset('Total Orders', TOTAL_ORDERS, v => v.toLocaleString(), true)
        ]
      },
      options: buildDualAxisOptions('Total Orders', true)
    });
  }

  // ---------- Card 4 ----------
  const milesCtx = document.getElementById('onTimeVsMilesChart');
  if (milesCtx) {
    new Chart(milesCtx, {
      data: {
        labels: LABELS,
        datasets: [
          onTimeDataset(),
          barDataset('Total Miles', TOTAL_MILES, v => v.toLocaleString() + ' mi', false)
        ]
      },
      options: buildDualAxisOptions('Total Miles', false)
    });
  }

  // ---------- Card 7 ----------
  const campusOpsCtx = document.getElementById('onTimeVsCampusOpsChart');
  if (campusOpsCtx) {
    new Chart(campusOpsCtx, {
      data: {
        labels: LABELS,
        datasets: [
          onTimeDataset(),
          barDataset('# Campus Operative', CAMPUS_OPERATIVE, v => v, false)
        ]
      },
      options: buildDualAxisOptions('# Campus Operative', false)
    });
  }// ---------- Card 5: On-Time % Orders (excluding kitchen / loading time) ----------
const kitchenCtx = document.getElementById('onTimeExcludingKitchenChart');
if (kitchenCtx) {

  const ON_TIME_EXCL_KITCHEN = [
    87.30, 92.67, 94.11, 93.47, 93.71,
    85.02, 83.44, 84.91, 86.32, 85.77,
    79.88, 82.41, 88.53, 91.26, 91.44,
    86.03, 89.71, 92.88, 94.02, 92.17
  ];

  new Chart(kitchenCtx, {
    data: {
      labels: LABELS,
      datasets: [
        {
          type: 'line',
          label: 'On-Time Orders %',
          data: ON_TIME,
          yAxisID: 'y',
          borderColor: GRAY_LINE,
          backgroundColor: GRAY_LINE,
          tension: 0.3,
          pointRadius: 4,
          datalabels: {
            formatter: v => v + '%',
            color: GRAY_LINE,
            font: { size: 12, weight: 'bold' },
            align: 'bottom',        // â¬…ï¸ baja SIEMPRE el label
            anchor: 'end',
            offset: 6
          }
        },
        {
          type: 'line',
          label: 'On-Time Orders % (excluding kitchen / loading time)',
          data: ON_TIME_EXCL_KITCHEN,
          yAxisID: 'y',
          borderColor: '#f59e0b',
          backgroundColor: '#f59e0b',
          borderDash: [6, 4],
          tension: 0.3,
          pointRadius: 4,
          datalabels: {
            formatter: v => v + '%',
            color: '#92400e',
            font: { size: 12, weight: 'bold' },
            align: 'bottom',        // â¬…ï¸ CLAVE: evita choque con leyenda
            anchor: 'end',
            offset: 6
          }
        }
      ]
    },
    options: {
      maintainAspectRatio: false,
      interaction: { mode: 'index', intersect: false },

      plugins: {
        legend: {
          position: 'top',
          fullSize: true,          // â¬…ï¸ reserva banda exclusiva arriba
          align: 'start',
          labels: {
            color: GRAY_LINE,
            padding: 40            // â¬…ï¸ empuja la grÃ¡fica hacia abajo
          }
        }
      },

      scales: {
        y: {
          min: 0,
          max: 100,
          ticks: {
            callback: v => v + '%',
            padding: 12
          },
          title: {
            display: true,
            text: 'On-Time Orders %'
          }
        }
      }
    }
  });
}

// ---------- Card 6: AVG Transit Times (Pickup â†’ Customer) ----------
const transitCtx = document.getElementById('avgTransitTimesChart');
if (transitCtx) {

  // EXACT data (no rounding / no modification) from: OPS - data_set_report_Q4_25 - Tablas Report (5).csv
  const AVG_IN_TRANSIT_TIME = [
    13.42, 13.67, 12.65, 12.25, 13.67,
    14.13, 15.14, 15.44, 14.97, 14.35,
    20.13, 19.54, 16.91, 15.89, 16.65,
    17.61, 18.16, 16.85, 15.67, 15.77
  ];

  const AVG_DELIVERY_TIME = [
    30.96, 30.79, 29.4, 29.4, 30.17,
    30.45, 37.72, 35.76, 35.12, 34.94,
    45.62, 43.54, 35.71, 33.87, 33.72,
    36.88, 35.27, 31.95, 30.4, 31.54
  ];

  new Chart(transitCtx, {
    data: {
      labels: LABELS,
      datasets: [
        {
          type: 'line',
          label: 'Avg In-Transit Time (min)',
          data: AVG_IN_TRANSIT_TIME,
          borderColor: GRAY_LINE,
          backgroundColor: GRAY_LINE,
          tension: 0.3,
          pointRadius: 4,
          datalabels: {
            formatter: v => v + 'm',     // displays exact value (e.g., 29.4)
            color: GRAY_LINE,
            font: { size: 12, weight: 'bold' },
            align: 'bottom',
            anchor: 'end',
            offset: 6
          }
        },
        {
          type: 'line',
          label: 'Avg Delivery Time (min)',
          data: AVG_DELIVERY_TIME,
          borderColor: '#f59e0b',
          backgroundColor: '#f59e0b',
          tension: 0.3,
          pointRadius: 4,
          borderDash: [6, 4],
          datalabels: {
            formatter: v => v + 'm',
            color: '#92400e',
            font: { size: 12, weight: 'bold' },
            align: 'bottom',
            anchor: 'end',
            offset: 6
          }
        }
      ]
    },
    options: {
      maintainAspectRatio: false,
      interaction: { mode: 'index', intersect: false },
      plugins: {
        legend: {
          position: 'top',
          fullSize: true,
          align: 'start',
          labels: {
            color: '#374151',
            padding: 40
          }
        }
      },
      scales: {
        y: {
          min: 0,
          max: 50,
          ticks: { callback: v => v + 'm' },
          title: { display: true, text: 'Minutes' }
        }
      }
    }
  });
}

// ---------- Card 7: Responsibility Split (STACKED %) ----------
const respCanvas = document.getElementById('responsibilityStackedChart');
if (respCanvas) {

  // EXACT data (no modifications)
  const PCT_ROBOT = [
    49, 52, 49, 49, 51,
    55, 53, 49, 47, 46,
    56, 55, 53, 54, 57,
    58, 61, 61, 54, 52
  ];

  const PCT_SODEXO = [
    40, 37, 39, 40, 37,
    33, 36, 40, 42, 43,
    36, 42, 42, 39, 40,
    42, 36, 35, 36, 37
  ];

  const PCT_CUSTOMER = [
    12, 12, 12, 12, 12,
    12, 10, 11, 11, 11,
    10, 9, 10, 12, 10,
    10, 11, 12, 12, 12
  ];

  new Chart(respCanvas, {
    data: {
      labels: LABELS,
      datasets: [
        {
          type: 'bar',
          label: 'Robot (%)',
          data: PCT_ROBOT,
          stack: 'resp',
          backgroundColor: '#6B7280', // gray
          borderWidth: 0,
          datalabels: {
            formatter: v => v + '%',
            color: '#111827',
            font: { size: 10, weight: 'bold' },
            anchor: 'center',
            align: 'center'
          }
        },
        {
          type: 'bar',
          label: 'Sodexo (%)',
          data: PCT_SODEXO,
          stack: 'resp',
          backgroundColor: '#f59e0b', // amber
          borderWidth: 0,
          datalabels: {
            formatter: v => v + '%',
            color: '#111827',
            font: { size: 10, weight: 'bold' },
            anchor: 'center',
            align: 'center'
          }
        },
        {
          type: 'bar',
          label: 'Customer (%)',
          data: PCT_CUSTOMER,
          stack: 'resp',
          backgroundColor: '#93c5fd', // ðŸ”µ light blue
          borderWidth: 0,
          datalabels: {
            formatter: v => v + '%',
            color: '#111827',
            font: { size: 10, weight: 'bold' },
            anchor: 'center',
            align: 'center'
          }
        }
      ]
    },
    options: {
      maintainAspectRatio: false,
      interaction: { mode: 'index', intersect: false },
      plugins: {
        legend: {
          position: 'top',
          fullSize: true,
          align: 'start',
          labels: {
            color: '#374151',
            padding: 32
          }
        },
        tooltip: {
          callbacks: {
            label: (ctx) => ` ${ctx.dataset.label}: ${ctx.parsed.y}%`
          }
        }
      },
      scales: {
        y: {
          stacked: true,
          min: 0,
          max: 110,
          ticks: { callback: v => v + '%' },
          title: { display: true, text: 'Responsibility split (%)' }
        }
      }
    }
  });
}

// ---------- Card 1: On-Time % Orders vs Headcount Field OPS ----------
const opsCanvas = document.getElementById('onTimeVsOpsChart');
if (opsCanvas) {

  // EXACT data from: OPS - data_set_report_Q4_25 - Tablas Report (9).csv
  const FIELD_OPS_HEADCOUNT = [
    46, 46, 46, 46, 46,
    32, 32, 32, 32, 32,
    29, 29, 29, 29, 29,
    27, 27, 27, 27, 27
  ];

  new Chart(opsCanvas, {
    data: {
      labels: LABELS,
      datasets: [
        {
          type: 'line',
          label: 'On-Time Orders %',
          data: ON_TIME,
          yAxisID: 'y',
          borderColor: '#6B7280',
          backgroundColor: '#6B7280',
          tension: 0.3,
          pointRadius: 4,
          datalabels: {
            formatter: v => v + '%',
            color: '#6B7280',
            font: { size: 12, weight: 'bold' },
            align: 'top',
            anchor: 'end'
          }
        },
        {
          type: 'bar',
          label: 'Headcount Field OPS',
          data: FIELD_OPS_HEADCOUNT,
          yAxisID: 'y1',
          backgroundColor: '#fde047',
          borderColor: '#facc15',
          borderWidth: 1,
          datalabels: {
            formatter: v => v,
            color: '#92400e',
            font: { size: 10 },
            anchor: 'center',
            align: 'center'
          }
        }
      ]
    },
    options: {
      maintainAspectRatio: false,
      interaction: { mode: 'index', intersect: false },
      plugins: {
        legend: {
          position: 'top',
          fullSize: true,
          align: 'start',
          labels: {
            color: '#374151',
            padding: 32
          }
        }
      },
      scales: {
        y: {
          position: 'left',
          min: 0,
          max: 100,
          ticks: { callback: v => v + '%' },
          title: { display: true, text: 'On-Time Orders % (0â€“40m SLA)' }
        },
        y1: {
          position: 'right',
          grid: { drawOnChartArea: false },
          title: { display: true, text: 'Headcount Field OPS' }
        }
      }
    }
  });
}


// ---------- Card 3: On-Time % Orders vs Fleet Availability ----------
const fleetCanvas = document.getElementById('onTimeVsFleetChart');
if (fleetCanvas) {

  // EXACT data from: OPS - data_set_report_Q4_25 - Tablas Report (10).csv
  const FLEET_AVAILABILITY = [
    81, 80, 83, 83, 84,
    81, 78, 78, 83, 87,
    83, 79, 81, 84, 85,
    81, 87, 93, 95, 95
  ];

  new Chart(fleetCanvas, {
    data: {
      labels: LABELS,
      datasets: [
        {
          type: 'line',
          label: 'On-Time Orders %',
          data: ON_TIME,
          yAxisID: 'y',
          borderColor: '#6B7280',
          backgroundColor: '#6B7280',
          tension: 0.3,
          pointRadius: 4,
          datalabels: {
            formatter: v => v + '%',
            color: '#6B7280',
            font: { size: 12, weight: 'bold' },
            align: 'top',
            anchor: 'end'
          }
        },
        {
          type: 'bar',
          label: 'Fleet Availability',
          data: FLEET_AVAILABILITY,
          yAxisID: 'y1',
          backgroundColor: '#fde047',
          borderColor: '#facc15',
          borderWidth: 1,
          datalabels: {
            formatter: v => v + '%',
            color: '#92400e',
            font: { size: 10 },
            anchor: 'center',
            align: 'center'
          }
        }
      ]
    },
    options: {
      maintainAspectRatio: false,
      interaction: { mode: 'index', intersect: false },
      plugins: {
        legend: {
          position: 'top',
          fullSize: true,
          align: 'start',
          labels: { color: '#374151', padding: 32 }
        }
      },
      scales: {
        y: {
          position: 'left',
          min: 0,
          max: 100,
          ticks: { callback: v => v + '%' },
          title: { display: true, text: 'On-Time Orders % (0â€“40m SLA)' }
        },
        y1: {
          position: 'right',
          min: 0,
          max: 100,
          grid: { drawOnChartArea: false },
          ticks: { callback: v => v + '%' },
          title: { display: true, text: 'Fleet Availability (%)' }
        }
      }
    }
  });
}

// ---------- Card 9: NPS Customer Campus (Executive) ----------
const npsCanvas = document.getElementById('npsCampusChart');
if (npsCanvas) {

  const NPS_LABELS = ['2023 Fall', '2024 Spring', '2024 Fall', '2025 Spring'];
  const NPS_SCORE  = [-22.22, -21.21, 33.3, 50];
  const NPS_RESPONSES = [27, 33, 15, 16];

  // Plugin: horizontal reference line at NPS = 0
  const zeroLinePlugin = {
    id: 'npsZeroLine',
    afterDraw(chart) {
      const { ctx, scales } = chart;
      const y = scales.y;
      if (!y) return;

      const yZero = y.getPixelForValue(0);

      ctx.save();
      ctx.beginPath();
      ctx.setLineDash([6, 4]);
      ctx.lineWidth = 2;
      ctx.strokeStyle = '#9CA3AF'; // neutral gray
      ctx.moveTo(chart.chartArea.left, yZero);
      ctx.lineTo(chart.chartArea.right, yZero);
      ctx.stroke();
      ctx.restore();
    }
  };

  new Chart(npsCanvas, {
    plugins: [zeroLinePlugin],
    data: {
      labels: NPS_LABELS,
      datasets: [
        {
          type: 'line',
          label: 'NPS Score',
          data: NPS_SCORE,
          yAxisID: 'y',
          borderColor: '#6B7280',
          backgroundColor: '#6B7280',
          tension: 0.3,
          pointRadius: 5,
          pointHoverRadius: 6,
          datalabels: {
            formatter: v => (Math.round(v * 10) / 10).toString(),
            color: '#6B7280',
            font: { size: 12, weight: 'bold' },
            align: 'top',
            anchor: 'end',
            offset: 4
          }
        },
        {
  type: 'bar',
  label: '# Responses',
  data: NPS_RESPONSES,
  yAxisID: 'y1',
  backgroundColor: '#fde047',   // âœ… MISMO amarillo del resto
  borderColor: '#facc15',
  borderWidth: 1,
  datalabels: {
    formatter: v => v,
    color: '#92400e',
    font: { size: 10, weight: 'bold' },
    anchor: 'end',              // ðŸ‘ˆ evita cruce con eje 0
    align: 'bottom',            // ðŸ‘ˆ empuja el texto hacia abajo
    offset: 6
          }
        }
      ]
    },
    options: {
      maintainAspectRatio: false,
      interaction: { mode: 'index', intersect: false },
      plugins: {
        legend: {
          position: 'top',
          fullSize: true,
          align: 'start',
          labels: { color: '#374151', padding: 28 }
        }
      },
      scales: {
        y: {
          position: 'left',
          min: -100,
          max: 100,
          ticks: { stepSize: 25 },
          title: { display: true, text: 'NPS Score' }
        },
        y1: {
          position: 'right',
          grid: { drawOnChartArea: false },
          title: { display: true, text: '# Responses' }
        }
      }
    }
  });
}
  
  
});




</script>

</body>
</html>
