<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="Operational report / Strategy Offsite Q4 2025"/>
<title>Operational report / Strategy Offsite Q4 2025</title>

<!-- Chart.js + DataLabels -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0" defer></script>

<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
  background-color: #f9fafb;
  color: #374151;
  line-height: 1.6;
}

.container { padding: 2rem; max-width: 1200px; margin: 0 auto; }
.space-y-8 > * + * { margin-top: 2rem; }

.card {
  background: #fff;
  border-radius: 0.8rem;
  padding: 1.5rem;
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.card h2 {
  font-size: 1.35rem;
  font-weight: 800;
  margin-bottom: 1rem;
  color: #78350f;
}

.cover-slide {
  text-align: center;
  padding: 2.5rem;
  background-color: #fffbeb;
  border-radius: 1rem;
  border: 1px solid #fde68a;
}

.cover-slide h1 {
  font-size: 2rem;
  font-weight: 900;
  color: #b45309;
}

.cover-slide .meta {
  margin-top: 0.5rem;
  font-size: 0.9rem;
  color: #6b7280;
}

.text-sm { font-size: 0.92rem; }
.text-gray-700 { color: #374151; }
.text-center { text-align: center; }
.mt-4 { margin-top: 1rem; }

.chart-container {
  position: relative;
  height: 340px;
  margin-top: 1rem;
}

.btn {
  padding: 0.6rem 0.9rem;
  border: 1px solid #f59e0b;
  border-radius: 0.6rem;
  background: #fff7ed;
  cursor: pointer;
}

.btn:hover { background: #ffedd5; }

@media print {
  .no-print { display: none !important; }
  body { background: #fff; }
  .card { box-shadow: none; border: 1px solid #fcd34d; }
}
</style>
</head>

<body>

<!-- Logo -->
<div style="display:flex; justify-content:center; margin:2rem 0;">
  <img src="logo.png" alt="robot.com logo" style="height:56px;">
</div>

<div class="container space-y-8">

  <!-- Cover -->
  <div class="cover-slide">
    <h1>Operational Report / Strategy Offsite Q4 2025</h1>
    <p class="meta">Prepared by: Sergio Pachón · Andres Severino · Carlos Camelo</p>
  </div>

  <!-- Context -->
  <section class="card text-center" id="context">
    <h2>Report Context: On-Time Orders, NPS, and Growth Constraints</h2>
    <p class="text-sm text-gray-700">
      This report uses <strong>On-Time Orders % (0–40 minute SLA)</strong> as the primary performance metric.
      Performance is analyzed through dual-axis comparisons against operational drivers,
      complemented by NPS feedback and growth constraints identified by Sodexo.
    </p>
  </section>

  <!-- Card 1 -->
  <div class="card">
    <h2>1. On-Time % Orders vs # Ops</h2>
  </div>

  <!-- Card 2 -->
  <div class="card" id="card-2">
    <h2>2. On-Time % Orders vs Volume Orders</h2>

    <div class="chart-container">
      <canvas id="onTimeVsOrdersChart"></canvas>
    </div>

    <p class="text-sm text-gray-700 mt-4">
      Relationship between service reliability (On-Time SLA 0–40m) and total order volume over time.
    </p>
  </div>

  <!-- Card 3 -->
  <div class="card">
    <h2>3. On-Time % Orders vs Fleet Availability</h2>
  </div>

  <!-- Card 4 -->
  <div class="card" id="card-4">
    <h2>4. On-Time % Orders vs Total Miles</h2>

    <div class="chart-container">
      <canvas id="onTimeVsMilesChart"></canvas>
    </div>

    <p class="text-sm text-gray-700 mt-4">
      Comparison between <strong>On-Time Orders %</strong> and <strong>Total Miles</strong>,
      highlighting the impact of delivery distance on SLA performance.
    </p>
  </div>

  <!-- Card 5 -->
  <div class="card">
    <h2>5. On-Time % Orders (excluding charging time)</h2>
  </div>

  <!-- Card 6 -->
  <div class="card">
    <h2>6. AVG Transit Times (Pickup → Customer)</h2>
  </div>

  <!-- Card 7 -->
  <div class="card" id="card-7">
    <h2>7. On-Time % Orders vs # Campus Operative</h2>

    <div class="chart-container">
      <canvas id="onTimeVsCampusOpsChart"></canvas>
    </div>

    <p class="text-sm text-gray-700 mt-4">
      This chart compares <strong>On-Time Orders % (0–40m SLA)</strong> against the
      <strong>number of operative campuses</strong>, showing how operational scale
      impacts service reliability.
    </p>
  </div>

  <!-- Card 8 -->
  <div class="card">
    <h2>8. NPS Customer Campus</h2>
  </div>

  <!-- Card 9 -->
  <div class="card">
    <h2>9. Pains Sodexo and Plan</h2>
  </div>

  <!-- Actions -->
  <div class="no-print" style="display:flex; justify-content:flex-end;">
    <button class="btn" onclick="window.print()">Print / Save as PDF</button>
  </div>

</div>

<!-- Charts JS -->
<script>
window.addEventListener('DOMContentLoaded', () => {
  if (!window.Chart) return;
  if (window.ChartDataLabels) Chart.register(ChartDataLabels);

  // Visual standard (as agreed)
  const GRAY_LINE = '#6B7280';     // On-Time line + legend + % labels
  const AMBER_LABEL = '#92400e';   // Bar labels

  // Data (2024 + 2025) — keep exactly as provided previously
  const LABELS = [
    "Jan-2024","Feb-2024","Mar-2024","Apr-2024","May-2024",
    "Aug-2024","Sep-2024","Oct-2024","Nov-2024","Dec-2024",
    "Jan-2025","Feb-2025","Mar-2025","Apr-2025","May-2025",
    "Aug-2025","Sep-2025","Oct-2025","Nov-2025","Dec-2025"
  ];

  const ON_TIME = [
    73.51,81.77,83.85,82.63,83.77,
    62.75,60.33,62.28,65.01,64.83,
    37.56,43.3,60.73,74.62,74.65,
    59.29,67.16,77.7,81.4,78.11
  ];

  const TOTAL_ORDERS = [
    8365,12769,8807,10493,1489,
    2389,11604,12477,10070,6160,
    10108,15542,11810,13362,3267,
    3028,14376,14824,11789,5422
  ];

  const TOTAL_MILES = [
    0,0,0,0,23,
    53,516,3861,7140,3100,
    11127,18719,17290,20241,8647,
    7035,22371,30755,23876,12612
  ];

  const CAMPUS_OPERATIVE = [
    28,27,26,27,21,
    15,19,18,20,20,
    18,19,19,19,16,
    14,16,16,16,16
  ];

  // Shared options builder
  function buildDualAxisOptions(rightLabel, liftLegend=false) {
    return {
      maintainAspectRatio: false,
      interaction: { mode: 'index', intersect: false },

      // Only lift legend in Card 2 to prevent overlap with % labels
      layout: liftLegend ? { padding: { top: 24 } } : {},

      plugins: {
        legend: {
          position: 'top',
          labels: {
            color: GRAY_LINE,
            padding: liftLegend ? 22 : 12
          }
        },
        tooltip: {
          callbacks: {
            label: function(context) {
              if (context.dataset.yAxisID === 'y') {
                return ` ${context.dataset.label}: ${context.parsed.y}%`;
              }
              return ` ${context.dataset.label}: ${context.parsed.y.toLocaleString()}`;
            }
          }
        }
      },

      scales: {
        y: {
          position: 'left',
          min: 0,
          max: 100,
          ticks: { callback: v => v + '%' },
          title: { display: true, text: 'On-Time Orders % (0–40m SLA)' }
        },
        y1: {
          position: 'right',
          grid: { drawOnChartArea: false },
          title: { display: true, text: rightLabel }
        }
      }
    };
  }

  // Dataset builders
  function onTimeDataset() {
    return {
      type: 'line',
      label: 'On-Time Orders %',
      data: ON_TIME,
      yAxisID: 'y',
      borderColor: GRAY_LINE,
      backgroundColor: GRAY_LINE,
      tension: 0.3,
      pointRadius: 4,
      pointHoverRadius: 5,
      datalabels: {
        formatter: v => v + '%',
        color: GRAY_LINE,
        font: { size: 12, weight: 'bold' },
        align: 'top',
        anchor: 'end'
      }
    };
  }

  // Bars: default center labels; optional "special-case" for Feb-2025 in Card 2
  function barDataset(label, data, formatter, specialCaseFeb2025=false) {
    return {
      type: 'bar',
      label,
      data,
      yAxisID: 'y1',
      backgroundColor: '#fde047',
      borderColor: '#facc15',
      borderWidth: 1,
      datalabels: {
        formatter,
        color: AMBER_LABEL,
        font: { size: 10, weight: 'normal' },
        anchor: 'center',
        align: (ctx) => {
          if (specialCaseFeb2025 && LABELS[ctx.dataIndex] === 'Feb-2025') {
            return 'bottom'; // move down ONLY for Card 2 / Feb-2025
          }
          return 'center';
        }
      }
    };
  }

  // ---------- Card 2 ----------
  const ordersCtx = document.getElementById('onTimeVsOrdersChart');
  if (ordersCtx) {
    new Chart(ordersCtx, {
      data: {
        labels: LABELS,
        datasets: [
          onTimeDataset(),
          barDataset('Total Orders', TOTAL_ORDERS, v => v.toLocaleString(), true)
        ]
      },
      options: buildDualAxisOptions('Total Orders', true)
    });
  }

  // ---------- Card 4 ----------
  const milesCtx = document.getElementById('onTimeVsMilesChart');
  if (milesCtx) {
    new Chart(milesCtx, {
      data: {
        labels: LABELS,
        datasets: [
          onTimeDataset(),
          barDataset('Total Miles', TOTAL_MILES, v => v.toLocaleString() + ' mi', false)
        ]
      },
      options: buildDualAxisOptions('Total Miles', false)
    });
  }

  // ---------- Card 7 ----------
  const campusOpsCtx = document.getElementById('onTimeVsCampusOpsChart');
  if (campusOpsCtx) {
    new Chart(campusOpsCtx, {
      data: {
        labels: LABELS,
        datasets: [
          onTimeDataset(),
          barDataset('# Campus Operative', CAMPUS_OPERATIVE, v => v, false)
        ]
      },
      options: buildDualAxisOptions('# Campus Operative', false)
    });
  }
});
</script>

</body>
</html>
